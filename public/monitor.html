<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>智能监控平台</title>
    <script src="./js/echarts.min.js"></script>
    <script src="./js/2.6.14_vue.min.js"></script>
    <script src="./js/EasyPlayer-pro.js"></script>
    <link rel="stylesheet" href="./css/monitor.css" />
  </head>

  <body>
    <div class="container" id="app">
      <div class="header">
        <button class="back-button" id="back">后台</button>
        <h1>智能监控平台</h1>
      </div>
      <div class="left-panel">
        <div class="module-section device-list-module">
          <div class="section-title">设备列表</div>
          <div class="tree-view-wrapper">
            <div class="tree-view">
              <ul>
                <template v-for="group in deviceGroups">
                  <li v-if="group.devices.length > 0">
                    <div class="node-content parent" @click="toggleGroup(group.id)">
                      <span
                        class="indicator"
                        :class="{ 'collapsed': !(groupStates[group.id] && groupStates[group.id].expanded) }"
                      >
                        {{ (groupStates[group.id] && groupStates[group.id].expanded) ? '▼' : '▶' }}
                      </span>
                      <span>{{ group.name }}</span>
                    </div>
                    <ul
                      class="nested"
                      :class="{ 'active': groupStates[group.id] && groupStates[group.id].expanded }"
                    >
                      <li v-for="device in group.devices" :key="device.deviceid">
                        <div
                          class="node-content"
                          :class="{ 'disabled': !device.online, 'selected': selectedDeviceId === device.deviceid }"
                          @click="handleDeviceClick(device)"
                        >
                          <span class="device-status" :class="getDeviceStatusClass(device)"></span>
                          <span>{{ device.devicename }}</span>
                        </div>
                      </li>
                    </ul>
                  </li>
                </template>
              </ul>
            </div>
          </div>
        </div>
        <div class="module-section cpu-module-section">
          <div
            class="section-title"
            style="display: flex; align-items: center; gap: 50px; justify-content: flex-start"
          >
            内存/CPU
          </div>
          <div id="cpu-chart" class="cpu-chart-container"></div>
        </div>
        <div class="module-section storage-module-section">
          <div class="section-title">存储</div>
          <div class="storage-bar-outer">
            <div class="storage-bar-inner" id="storage-bar-inner"></div>
            <div class="storage-bar-label" id="storage-bar-label">45%</div>
          </div>
        </div>
      </div>
      <div class="main-content">
        <div class="video-section" id="app">
          <div class="section-title video-title-bar">
            <span>实时调阅</span>
            <span class="time-display" style="margin-left: 20px">{{ currentTime }}</span>
            <div class="screen-switch" style="margin-left: auto">
              <span class="control-icon" @click="onPlayer">
                <svg
                  t="1750127183805"
                  class="icon"
                  viewBox="0 0 1024 1024"
                  version="1.1"
                  xmlns="http://www.w3.org/2000/svg"
                  p-id="2667"
                  width="200"
                  height="200"
                >
                  <path
                    d="M772.096 875.52l87.04-1.536 2.048 102.4-256.512 4.608-4.608-256.512 102.4-1.536 1.536 75.776c156.16-122.88 182.784-348.672 60.416-504.32-69.632-88.576-176.128-139.264-288.256-137.216l4.096-102.912c254.976-1.024 462.848 204.8 463.872 459.776 0.512 140.8-62.976 273.408-172.032 361.472zM203.264 147.456l-87.04 1.536-1.536-102.4 256.512-4.608 4.608 256.512-102.4 1.536-2.048-75.776c-156.16 122.88-182.784 348.672-60.416 504.32 69.632 88.064 176.128 139.264 288.256 137.216l-4.096 102.912c-254.976 1.024-462.848-204.8-463.872-459.776C31.232 368.64 94.208 235.52 203.264 147.456z"
                    p-id="2668"
                  ></path>
                </svg>
              </span>
              <span class="control-icon" @click="onStop">
                <svg
                  t="1750127118511"
                  class="icon"
                  viewBox="0 0 1024 1024"
                  version="1.1"
                  xmlns="http://www.w3.org/2000/svg"
                  p-id="1594"
                  width="200"
                  height="200"
                >
                  <path
                    d="M567.02 36.49H456.98v558.04h110.04V36.49z m199.11 136.23l-81.22 81.22c50.65 29.69 90.38 69.86 119.21 120.52 28.82 50.65 43.23 106.11 43.23 166.36 0 60.26-14.85 116.15-44.54 167.68-29.69 51.52-70.3 92.13-121.82 121.82-51.53 29.69-107.85 44.54-168.98 44.54-61.13 0-117.46-14.85-168.98-44.54-51.53-29.69-92.13-70.3-121.83-121.82-29.69-51.53-44.54-107.42-44.54-167.68 0-60.26 14.41-115.71 43.23-166.36s67.68-90.82 116.59-120.52l-78.6-81.22c-59.39 41.92-106.54 94.75-141.48 158.5C81.47 394.98 64 464.41 64 539.51c0 80.34 20.08 155.01 60.26 224S219.01 887.08 288 927.25c68.99 40.17 143.66 60.26 224 60.26s155.01-20.09 224-60.26c68.99-40.17 123.57-94.75 163.74-163.74 40.17-68.99 60.26-143.66 60.26-224 0-75.1-17.47-144.53-52.4-208.28s-82.09-116.59-141.47-158.51z"
                    p-id="1595"
                  ></path>
                </svg>
              </span>
              <div class="divider"></div>
              <span
                v-for="item in [1,4]"
                :key="item"
                :class="['screen-btn', {active: screenCount===item}]"
                @click="switchScreen(item)"
              >
                <svg
                  v-if="item === 1"
                  viewBox="0 0 1024 1024"
                  version="1.1"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    d="M960 920c0 22-18 40-40 40H104c-22 0-40-18-40-40V104c0-22 18-40 40-40h816c22 0 40 18 40 40v816z"
                  ></path>
                </svg>
                <svg
                  v-else
                  viewBox="0 0 1024 1024"
                  version="1.1"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    d="M480 96v288c0 53-43 96-96 96H96c-53 0-96-43-96-96V96C0 43 43 0 96 0h288c53 0 96 43 96 96zM1024 96v288c0 53-43 96-96 96H640c-53 0-96-43-96-96V96c0-53 43-96 96-96h288c53 0 96 43 96 96zM480 640v288c0 53-43 96-96 96H96c-53 0-96-43-96-96V640c0-53 43-96 96-96h288c53 0 96 43 96 96zM1024 640v288c0 53-43 96-96 96H640c-53 0-96-43-96-96V640c0-53 43-96 96-96h288c53 0 96 43 96 96z"
                  ></path>
                </svg>
              </span>
              <div class="divider"></div>
              <span class="fullscreen-btn" @click="setFullscreen">
                <svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
                  <path
                    d="M368.896 192H224a32 32 0 0 0-32 32v137.888a32 32 0 0 0 64 0V256h112.896a32 32 0 0 0 0-64zM784.864 192H640a32 32 0 1 0 0 64h112.864v105.888a32 32 0 1 0 64 0V224a32 32 0 0 0-32-32zM368.896 777.92H256V672a32 32 0 1 0-64 0v137.92a32 32 0 0 0 32 32h144.896a32 32 0 1 0 0-64zM784.864 640a32 32 0 0 0-32 32v105.92H640a32 32 0 1 0 0 64h144.864a32 32 0 0 0 32-32V672a32 32 0 0 0-32-32z"
                  ></path>
                  <path
                    d="M912 48h-800c-35.296 0-64 28.704-64 64v800c0 35.296 28.704 64 64 64h800c35.296 0 64-28.704 64-64v-800c0-35.296-28.704-64-64-64z m-800 864v-800h800l0.064 800H112z"
                  ></path>
                </svg>
              </span>
            </div>
          </div>
          <div class="video-frame" :class="'screen-'+screenCount">
            <div
              v-for="n in screenCount"
              :key="n"
              :id="'easyplayer-container-'+n"
              class="player-box"
              @click="handleScreenClick(n-1)"
            ></div>
          </div>
        </div>
      </div>
      <div class="right-panel">
        <div class="module-section device-status-module">
          <div class="section-title">设备状态</div>
          <div
            style="
              display: flex;
              justify-content: space-around;
              align-items: flex-start;
              padding: 0;
            "
          >
            <div class="gauge-wrapper">
              <div id="gauge-startup" class="gauge-container"></div>
              <div class="stat-text" style="display: flex; gap: 10px; justify-content: center">
                <span>启动: {{ deviceStats.started }}</span>
                <span>待机: {{ deviceStats.online - deviceStats.started }}</span>
              </div>
            </div>
            <div class="gauge-wrapper">
              <div id="gauge-online" class="gauge-container"></div>
              <div class="stat-text" style="display: flex; gap: 10px; justify-content: center">
                <span>在线: {{ deviceStats.online }}</span>
                <span>离线: {{ deviceStats.total - deviceStats.online }}</span>
              </div>
            </div>
          </div>
        </div>
        <div class="module-section alert-capture-module">
          <div class="section-title">预警抓拍</div>
          <div class="alert-list-wrapper">
            <div
              class="alert-item"
              v-for="(item, idx) in alertList"
              :key="idx"
              @click="showAlertDrawer(item)"
            >
              <div class="alert-icon">
                <img :src="item.icon" alt="Alert Icon" />
              </div>
              <div class="alert-info">
                <div class="alert-title">{{ item.title }}</div>
                <div class="alert-time">{{ item.time }}</div>
                <div class="alert-location">{{ item.location }}</div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div v-if="drawerVisible" class="alert-drawer-overlay" @click.self="closeAlertDrawer">
        <div class="alert-drawer">
          <div class="alert-drawer-header">
            <div class="alert-icon">
              <img
                :src="drawerData.icon"
                alt="Alert Icon"
                style="width: 100%; height: 100%; object-fit: cover"
              />
            </div>
            <div class="alert-title">{{ drawerData.title }}</div>
          </div>
          <div class="alert-drawer-img" v-if="drawerData.img">
            <img
              :src="drawerData.img"
              alt="抓拍图片"
              style="width: 100%; height: auto; display: block"
            />
          </div>
          <div class="alert-drawer-info">
            <div class="alert-drawer-info-row">
              <span class="alert-drawer-info-label">类型</span>
              <span class="alert-drawer-info-value">{{ drawerData.type || '未知' }}</span>
            </div>
            <div class="alert-drawer-info-row">
              <span class="alert-drawer-info-label">等级</span>
              <span class="alert-drawer-info-value">{{ drawerData.level || '一般' }}</span>
            </div>
            <div class="alert-drawer-info-row">
              <span class="alert-drawer-info-label">时间</span>
              <span class="alert-drawer-info-value">{{ drawerData.time }}</span>
            </div>
            <div class="alert-drawer-info-row">
              <span class="alert-drawer-info-label">布点</span>
              <span class="alert-drawer-info-value">{{ drawerData.location }}</span>
            </div>
            <div class="alert-drawer-info-row">
              <span class="alert-drawer-info-label">处理状态</span>
              <span class="alert-drawer-info-value">{{ drawerData.status || '未处理' }}</span>
            </div>
            <div class="alert-drawer-info-row">
              <span class="alert-drawer-info-label">处理人</span>
              <span class="alert-drawer-info-value">{{ drawerData.handler || '-' }}</span>
            </div>
            <div class="alert-drawer-info-row">
              <span class="alert-drawer-info-label">处理时间</span>
              <span class="alert-drawer-info-value">{{ drawerData.handleTime || '-' }}</span>
            </div>
          </div>
          <div class="alert-drawer-desc" v-if="drawerData.desc"> {{ drawerData.desc }} </div>
          <div class="alert-drawer-info-row" v-if="drawerData.remark">
            <span class="alert-drawer-info-label">备注</span>
            <span class="alert-drawer-info-value">{{ drawerData.remark }}</span>
          </div>
          <div class="alert-drawer-actions">
            <button class="alert-drawer-action-btn" @click="onAlertAction(drawerData)">
              处理
            </button>
          </div>
        </div>
      </div>
    </div>
    <script src="./js/monitor.js"></script>
  </body>
</html>
